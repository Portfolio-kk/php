<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP</title>
    <style>
        .red {
            color: red;
        }

        .blue {
            color: blue;
        }

        .gray {
            color: rgb(120, 120, 120);
        }

        pre,
        code {
            font-size: 15px;
            border: solid 1px rgb(193, 193, 193);
            padding: 3px 7px;
            border-radius: 8px;
            background: #efefef;
        }

        pre {
            padding-top: 20px;
            background: #f6f6f6;
        }

        .col-2 {
            border-collapse: collapse;
            /* セルの線を重ねる */
            width: 100%;
        }

        .col-2 th,
        .col-2 td {
            border: 1px solid #000;
            padding: 10px;
            /* 余白 */
        }

        .center {
            border: 1px solid #000;
            border-collapse: collapse;
            width: 100%;
            text-align: center;
        }

        .center th,
        .center td {
            border: 1px solid #000;
        }

        .col-5 th,
        .col-5 td {
            width: calc(100% / 5);
        }

        #toTop {
            position: fixed;
            bottom: 0;
            right: 0;
            background: rgba(0, 0, 0, .1);
            width: 50px;
            height: 50px;
            text-align: center;
            line-height: 50px;
        }

        #toTop a {
            display: block;
            color: #000;
            text-decoration: none;
        }

        #toc {
            max-width: 500px;
            border: 2px solid rgba(0, 0, 0, .1);
            margin: 2em auto;
        }

        .toc-title {
            color: #444;
            padding: .5em 1em;
        }

        .toc-container {
            padding: 1em !important;
            margin: 0 !important;
        }

        .toc-container,
        .toc-container ul {
            counter-reset: ul-counter;
            list-style: none;
        }

        .toc-container li a {
            display: flex;
            color: #444 !important;
        }

        .toc-container li a:before {
            counter-increment: ul-counter;
            content: counters(ul-counter, ".");
            color: dodgerblue;
            /* お好みの色 */
            padding-right: .5em;
            white-space: nowrap;
        }

        #toc .toc-title:after {
            content: '[ひらく]';
            margin-left: .5em;
        }

        #toc[open] .toc-title:after {
            content: '[とじる]';
        }
    </style>
</head>

<body>
    <nav>
        <ul>
            <li><a href="../js/index.html">Javascript</a></li>
            <li><a href="../jQuery/index.html">jQuery</a></li>
            <li><a href="../php/index.html">PHP</a></li>
            <li><a href="../wp/index.html">WP</a></li>
        </ul>
    </nav>
    <h1>PHP</h1>
    <details id="toc" open>
        <summary class="toc-title">目次</summary>
    </details>
    <h2>ショートカット</h2>
    <ul>
        <li>⌘ J ：ターミナルを開く</li>
        <li>⌘ 1 ：ターミナル＞エディター</li>
        <li>⌘ T ：エディター＞ターミナル</li>
        <li>⌥ ¥ : バックスラッシュ(\)</li>
        <li>Control C : 無限ループを止める</li>
    </ul>
    <h2>Docker</h2>
    <ul>
        <li>
            <a href="https://docker.com">docker</a>
        </li>
        <li>Products > Docker Desktop > ダウンロード　＞　アプリケーションにコピー　＞　デスクトップのDockerを右クリック　取り外す</li>
        <li>アクセス許可　＞　Dockerが開く</li>
        <li>レッスンではDockerが起動している必要があるので、トップのメニューにくじらのアイコンがあるのを確認してから始める</li>
    </ul>
    <h2>PHP 環境</h2>
    <ul>
        <li><a href="https://php.net">PHP　公式</a></li>
        <li>ブラウザー　→　 Request →　サーバー(要求に対して返す　サーブしてくれる)</li>
        <li>ブラウザー　←　 Response ←　サーバー　【phpならコードを実行してからhtmlに返還して返す】</li>
        <li>Dockerの上でサーバーを起動　（他のPCでもDockerを入れてあれば動く）</li>
        <li>Dockerからのアクセス方法　localhost:8080番ポート</li>
        <li>BASIC_PHP_V3 をダウンロード　VSCodeで開く php docker-compose.yml は触らない！ workを編集＞サーバーに同期される</li>
        <li>ターミナルを起動　ディレクトリに移動</li>
        <li><code>docker-compose up -d</code></li>
    </ul>
    <h2>PHP</h2>
    <ul>
        <li>.index > .php</li>
        <li><a href="http://localhost:8080/index.php">http://localhost:8080/index.php PHP分割サイト</a></li>
        <li>
            <span class="red">&lt;?php</span> echo &apos;こんにちは！&apos;<span class="red">; ?&gt;</span>
        </li>
        <li>
            &lt;?php echo &apos;こんにちは！&apos; . date(&apos;l&apos;); ?&gt; // 今日の曜日
        </li>
        <li>$*** 変数が使える　htmlの外で宣言</li>
        <li>
            <span class="red">&lt;?php echo</span> $message; ?&gt; <br>
            <span class="red">&lt;?=</span> $message; ?&gt; // 同じ
        </li>
        <li><span class="red">mt_rand(1, 3);</span> // 1以上3以下のランダムな整数値を生成</li>
        <li>if elseif(else if) else jsと同じように使える</li>
        <li>$n = mt_rand(1, 2); <br>
            if ($n === 1) {メッセージ１} <br>
            elseif ($n === 2) {メッセージ１}
        </li>
        <li>値を埋め込む時には悪意のある書き換えが不可にする為に、
            実体参照文字に変換
            <br>
            <span class="red">htmlspecialchars($message, ENT_QUOTES, 'UTF-8');</span><br>
            オプション①変換したい文字　②’マークも変換してね　③文字コード
        </li>
    </ul>
    <h2>共通部品</h2>
    <ul>
        <li>index.php から　_header.php へカットして移し、
            <br>
            &lt;?php <span class="red">include(</span>&apos;_header.php&apos;<span class="red">)</span>; ?&gt;
        </li>
        <li>phpの閉じタグは、その下にhtmlがなければ省略！ファイル最後の空白文字が出力に影響する為</li>
        <li>ページのソースを表示　でエラーが確認できる</li>
        <li>title 共通コードを埋めたら、空文字でも指定しないとエラー</li>
    </ul>

    <h2>詳解PHP 【基礎文法編】</h2>
    <ul>
        <li>
            <h3>#01 PHPは動的サイト</h3>
            <p>ユーザーによって異なる名前に変更する等、見る人によって動的にサイトを書き換える。(PHP)</p>
            <p>いつ誰が見ても同じサイトは静的サイト(HTML)</p>
        </li>
        <li>
            <h3>#02ターミナル</h3>
            <p>php ***.php Enter</p>
            <p>ターミナルに出力しながら開発していく</p>
            <p>ターミナルをクリアするには　clear か　Control + L</p>
        </li>
        <li>
            <h3>#03 メッセージを表示</h3>
            <ul>
                <li>改行　<span class="red">. PHP_EOL</span> end of line</li>
                <li>エラー　<span class="red">Parse error</span>：解析エラー <span class="red">syntax error</span>：文法エラー　ファイル名と行数
                    ***.php on line *</li>
            </ul>
        </li>
        <li>
            <h3>#04 コメントアウト</h3>
            <ul>
                <li>//</li>
                <li><span class="red">#</span></li>
                <li>/* ~~~ */　複数行</li>
            </ul>
        </li>
        <li>
            <h3>#05 変数</h3>
            <ul>
                <li>変数　$*** = '~~~';</li>
                <li>代入　大文字小文字は区別される</li>
            </ul>
        </li>
        <li>
            <h3>#06 文字列の扱い</h3>
            <ul>
                <li>文中の ' を " に変更</li>
                <li><span class="red"> " を使った場合、直接変数を入れれる</span>jsでいうテンプレートリテラルっぽい使い方 しかも${}なし</li>
                <li> " の中で " を使いたい場合 バックスラッシュ \(⌥¥)でエスケープ</li>
                <li>その他エスケープ　\t tab \n 改行</li>
            </ul>
        </li>
        <li>
            <h3>#07 ヒアドキュメント</h3>

            <pre>
        $変数 = <span class="red">&lt;&lt;&lt;終端記号 改行</span>
        ~~~ (この間の改行や字下げを保つ)
        <span class="red">終端記号</span>;
        </pre>
            <ul>
                <li>
                    好きな名前をつけていい　今回はEOT (end of text)
                </li>
                <li>この間の文字は改行や字下げを保つ　pre のような仕様だが、
                    コードを字下げしても終端記号に合わせられる
                </li>
                <li><span class="red">終端記号の後は必ず改行</span>　コメントでも書いてはいけない</li>
                <li>終端記号を ' で囲う　変数が使えない　nowdoc ナウドキュメント</li>
                <li><span class="red">終端記号を " で囲う・または囲わない　変数が使える　heredoc ヒアドキュメント</span></li>
            </ul>
        </li>
        <li>
            <h3>#08 数値の計算</h3>
            <p>jsと同じ</p>
            <pre>
                echo 10 + 3 . PHP_EOL; // 13
                echo 10 - 3 . PHP_EOL; // 7
                echo 10 * 3 . PHP_EOL; // 30
                echo 10 / 3 . PHP_EOL; // 3.333...
                
                echo 10 % 3 . PHP_EOL; // 余り　1
                echo 10 ** 3 . PHP_EOL; // べき乗　1000
                
                echo 2 + 10 * 3 . PHP_EOL; // 優先度　32
                echo (2 + 10) * 3 . PHP_EOL; // ()優先度　36
                
                #数値っぽいものは数値と認識
                echo 2 + '3' . PHP_EOL; // 5
            </pre>
        </li>
        <li>
            <h3>#09 変数の計算</h3>
            <pre>
                $price = 500;
                // $price = $price + 100; // 600
                $price += 100; // 同じ意味 他の四則演算も

                $price++;
                $price--;
                echo $price . PHP_EOL;
            </pre>
        </li>
        <li>
            <h3>#10 定数</h3>
            <ul>
                <li>const <span class="red">AAA</span> = '~~~'; // <span class="red">定数は大文字で</span></li>
                <li><span class="red">define('AAA', '~~~');</span> // constと同じ結果だが、細かい違いがある</li>
            </ul>
        </li>
        <li>
            <h3>#11 データ型</h3>
            <ul>
                <li>文字列(string) : 'hello' "world"</li>
                <li>整数<span class="red">(int)</span> : 5 -20</li>
                <li><span class="red">浮動小数点数(float)</span> : 3.2 -1.8</li>
                <li>null</li>
                <li>真偽値(bool) : true false</li>
                <li>配列(array) : [5, 3, 8]</li>
                <li>オブジェクト(object) : new Object()</li>
            </ul>
        </li>
        <li>
            <h3>#12 変数の型を調べる</h3>
            <span class="red">var_dumo(***);</span> jsの console.log(typeof ***)
            <pre>

                $a = 'hello';
                var_dump($a); // string(5) "hello"

                $b = 10;
                var_dump($b); // int(10)

                $c = -1.3;
                var_dump($c); // float(-1.3)

                $d = null;
                var_dump($d); // NULL

                $e = true;
                var_dump($e); // bool(true)

                #型を変換する キャスト
                $a = (float)10;
                var_dump($a);
            </pre>
        </li>

        <h2>構文</h2>
        <li>
            <h3>if文</h3>
            <pre>
                $score = 85;
                $score = 70;
                $score = 40;

                if ($score >= 80) {
                    echo 'Great!' . PHP_EOL;
                } else if ($score >= 60) {
                    echo 'Good!' . PHP_EOL;
                } else {
                    echo 'OK!' . PHP_EOL;
                }
            </pre>
            <p>セミコロン不要</p>
            <p>条件式は真偽値として評価 trueで実行</p>
            <h4>falseと評価される値</h4>
            <ul>
                <li>false</li>
                <li>±0</li>
                <li>±0.0</li>
                <li>'0' 文字列</li>
                <li>''</li>
                <li>null</li>
                <li>[]　空の配列</li>
            </ul>
            <p>※これ以外は全て true</p>
        </li>
        <li>
            <h3>比較演算子</h3>
            <pre>
                >= 〜以上
                <= 〜以下
                > 〜より大きい
                < 〜より小さい
                === 〜と等しい
                !== 〜と等しくない
            </pre>
            ※ == 値が等しい  / === 値と型が等しい
        </li>
        <li>
            <h3>論理演算子</h3>
            <ul>
                <li>&& : and なおかつ</li>
                <li>|| : or もしくは</li>
                <li>! : 〜ではない</li>
            </ul>
        </li>
        <li>
            <h3>switch文</h3>
            <pre>
                $signal = 'green';

                switch($signal) {
                    case 'red':
                        echo 'Stop!' . PHP_EOL;
                        break;
                    case 'yellow':
                        echo 'Caution!' . PHP_EOL;
                        break;
                    case 'blur':
                    case 'green':
                        echo 'Go!' . PHP_EOL;
                        break;
                        
                    default:
                        echo 'Wrong signal!' . PHP_EOL;
                        break;

                }
                // Go!
            </pre>
            <p>セミコロン不要</p>
            <p>※ break 忘れに注意　出てくるまで表示される</p>
        </li>
        <li>
            <h3>ループ</h3>
            <h4>for</h4>
            <pre>
                for ($i=1; $i < 5; $i++) { 
                    // echo 'Hello' . PHP_EOL;
                    echo "$i - Hello" . PHP_EOL;
                }
            </pre>
            <h4>while</h4>
            <pre>
                $hp = 100;
                while ($hp > 0) {
                    echo "Your HP: $hp" . PHP_EOL;
                    $hp -= 15;<span class="red">// 書き忘れると無限ループに！</span>
                }
                ※条件が満たされない場合は一回も実行されない
            </pre>
            <h4>do while</h4>
            一回だけは実行したい場合
            <pre>
                $hp = -50;
                do {
                    echo "Your HP: $hp" . PHP_EOL;
                    $hp -= 15;
                } while($hp > 0);
            </pre>
            <p>セミコロン不要</p>
            <h4>for while で特定の回だけスキップ</h4>
            <p>スキップ・ブレイク</p>
            <pre>
                for ($i=1; $i < 10; $i++) { 
                    // if ($i === 4) { // 4
                    if ($i % 3 === 0) { // 3の倍数
                        <span class="red">continue;// スキップ</span>
                    }
                    if ($i === 7) {
                        <span class="red">break;// ループを抜ける</span>
                    }
                    echo $i . PHP_EOL;
                }
                // 1 2 4 5
            </pre>
        </li>
        <li>
            <h3>関数</h3>
            <h4>引数</h4>
            <pre>
                function showAd($message = 'Ad') { // 仮引数 = 'デフォルト値'
                    echo "------------------" . PHP_EOL;
                    echo "--- $message ---" . PHP_EOL;
                    echo "------------------" . PHP_EOL;
                }
                showAd('Header Ad');// 実引数
                echo "Tom is great!" . PHP_EOL;
                echo "Bob is great!" . PHP_EOL;
                showAd();
                echo "Steve is great!" . PHP_EOL;
                echo "Bob is great!" . PHP_EOL;
                showAd('Footer Ad');
            </pre>
            <h4>return</h4>
            <pre>
                function sum($a, $b, $c) {
                    // echo $a + $b + $c . PHP_EOL;
                    // 値を更に加工するには return (その時点で値が戻され、処理が終了する)
                    <span class="red">return</span> $a + $b + $c;
                }
                // sum(100, 200, 300); // 600
                // sum(300, 400, 500); // 1200
                
                echo sum(100, 200, 300) + sum(300, 400, 500) . PHP_EOL; // 1800
            </pre>
            <h4>スコープ</h4>
            <pre>
                $rate = 1.1;
                function sum($a, $b, $c) {
                    <span class="red">global</span> $rate; // <span class="red">関数外で定義された変数を使える宣言</span>　（分かりづらくなる）
                    return ($a + $b + $c) * $rate;
                }
                echo sum(100, 200, 300) + sum(300, 400, 500) . PHP_EOL; // 1980
            </pre>
            <pre>
                $rate = 1.1; // <span class="red">グローバルスコープ</span>
                function sum($a, $b, $c) {
                    $rate = <span class="red">1.08</span>; // <span class="red">ローカルスコープ</span>
                    return ($a + $b + $c) * $rate;
                }    
                echo sum(100, 200, 300) + sum(300, 400, 500) . PHP_EOL; //<span class="red">ローカルスコープ1.08が使われる</span>ので、 1944

            </pre>
            <h4>無名関数</h4>
            <p>無名関数(クロージャー)　<span class="red">変数に代入する場合はセミコロンあり</span></p>
            <p>無名関数は関数自体を別の関数の引数にして渡す事ができる</p>
            <pre>
                $sumb = function ($a, $b, $c) {
                    return $a + $b + $c;
                };
                echo <span class="red">$</span>sumb(500, 500, 1000) . PHP_EOL;
            </pre>
            <h4>条件演算子</h4>
            <p>条件演算子 <span class="red">条件？true値 : false値;</span></p>
            <pre>
                function sumB($a, $b, $c) {
                    $total = $a + $b + $c;
                    // if ($total < 0) {
                    //     return 0;
                    // } else {
                    //     return $total;
                    // }
                    <span class="red">return $total < 0 ? 0 : $total;</span>
                }
                echo sumB(100, 300, 500) . PHP_EOL; // 900
                echo sumB(-1000, 300, 500) . PHP_EOL; // 0
            </pre>
            <h4>引数の型付け</h4>
            <p>引数の型を指定</p>
            <ul>
                <li><span class="red">引数の前に型を指定</span>　弱い型付け '4' > 4にしてしまう</li>
                <li>ファイルの文頭に　<span class="red">declare(strict_types=1);</span> あいまいな変換をしない　強い型付け　（jsの　use strict の様な感じ？）
                </li>
                <li><span class="red">void 返り値が存在しない事を宣言</span></li>
            </ul>
            <pre>
                function showInfo (<span class="red">string</span> $name, <span class="red">int</span> $score) <span class="red">: void</span> // <span class="red">返り値も型を指定できる</span>　返り値がない場合 <span class="red">void</span>
                {
                    echo $name . ': ' . $score . PHP_EOL;
                }
                showInfo('taguchi' , 40);
                // showInfo('taguchi' , 'dot');
                // showInfo('taguchi' , '4');
            </pre>
            <h4>nullを返す</h4>
            <ul>
                <li>型の前に <span class="red">?</span> をつけると選択肢にnullが入る</li>
                <li>現在のPHPでは、null以外の条件はつけれない stringかintかはムリ</li>
            </ul>
            <pre>
                function getAward(<span class="red">?</span>int $score): <span class="red">?</span>string // 型の前に ? をつけると、<span class="red">null か ○○ か という意味になる</span>
                {
                    return $score >= 100 ? 'Gold Medal' : null;
                }
                echo getAward(150) . PHP_EOL;
                echo getAward(40) . PHP_EOL;
                echo getAward(null) . PHP_EOL;
            </pre>
        </li>
        <li>
            <h3>配列</h3>
            <pre>
                $scores = [
                    90,
                    40,
                    100,
                ];
                $scores[1] = 60; // 再代入
                echo $scores[1] . PHP_EOL; // 40 → 60

                echo $scores . PHP_EOL;
                // Array
            </pre>
            <h4>var_dump() print_r()</h4>
            <pre>
                <span class="red">var_dump</span>($scores);
                // array(3) {
                //   [0]=>
                //   int(90)
                //   [1]=>
                //   int(60)
                //   [2]=>
                //   int(100)
                // }

                <span class="red">print_r</span>($scores);
                // Array
                // (
                //     [0] => 90
                //     [1] => 60
                //     [2] => 100
                // )
            </pre>
            <h4>キーを設定</h4>
            <pre>
                $eachScores = [
                    <span class="red">'tagichi' =></span> 90,
                    <span class="red">'f-koji'  =></span> 40,
                    <span class="red">'kikyo'   =></span> 100,
                ];
                var_dump($eachScores);
                // array(3) {
                //     ["tagichi"]=>
                //     int(90)
                //     ["f-koji"]=>
                //     int(40)
                //     ["kikyo"]=>
                //     int(100)
                //   }
                print_r($eachScores);
                //   Array
                //   (
                //       [tagichi] => 90
                //       [f-koji] => 40
                //       [kikyo] => 100
                //   )
                echo <span class="red">$eachScores['kikyo']</span>. PHP_EOL;
            </pre>
            <h4>foreach</h4>
            <pre>
                <span class="red">foreach</span> ($eachScores <span class="red">as $value</span>) {
                    echo $value . PHP_EOL;
                }
                // 90
                // 40
                // 100
                <span class="red">foreach</span> ($eachScores <span class="red">as $key => $value</span>) {
                    echo $key . ' - ' . $value . PHP_EOL;
                }
                // tagichi - 90
                // f-koji - 40
                // kikyo - 100
            </pre>
            <p>※　$key $value　等の引数は好きな文字に変更可能</p>
            <h4>配列の中の配列</h4>
            <p>jsスプレット構文のような事ができる</p>
            <p><span class="red">PHP ver.7.4以上</span></p>
            <pre>
                $score1 = [
                55,
                72,
                ];
                $score2 = [
                90,
                40,
                <span class="red">...</span>$score1,
                100,
                ];
                print_r($score2);
            </pre>
            <p>配列の中に文字列・配列が入れられる</p>
            <pre>
                $score1 = [
                55,
                72,
                'perfect',
                [90, 42, 88],
                ];
                // 88にアクセス $scores1<span class="red">[3][2]</span>
            </pre>
            <h4>配列の関数　可変長引数</h4>
            <pre>
                // function sum($a, $b, $c) {
                //     return $a + $b + $c;
                // }

                ↓

                function sum(<span class="red">...$numbers</span>) {
                    <span class="red">
                        $total = 0;
                        foreach($numbers as $number) {
                            $total += $number;
                        }
                        return $total;
                    </span>
                }
                echo sum(1, 3, 5) . PHP_EOL; // 9
                echo sum(1, 3, 5, 6) . PHP_EOL; // 15
            </pre>
            <h4>複数の返り値を受け取る</h4>
            <pre>
                function getStats(...$numbers) {
                    $total = 0;
                    foreach($numbers as $number) {
                        $total += $number;
                    }
                    return [$total, $total / <span class="red">count</span>($numbers)];
                    // <span class="red">配列の個数 count($***) jsの.length</span>
                }
                print_r(getStats(1, 3, 5));// 合計：9 平均：3

                #変数に一気に代入 list()

                <span class="red">list</span>($sum, $average) = getStats(1, 3, 5);
                [$sum, $average] = getStats(1, 3, 5);
                echo $sum . PHP_EOL; // 9
                echo $average . PHP_EOL; // 3
            </pre>
        </li>
    </ul>
    <!-- <h2>詳解PHP ビルトイン関数編</h2> -->
    <h2>詳解PHP 【ビルトイン関数】</h2>
    <ul>
        <li>
            <h3>ビルトイン関数　一部</h3>
            <p>PHPが最初から用意してくれてる関数(組み込み関数)</p>
            <ul>
                <li>strlen('hello') // 5</li>
                <li>number_format(523350)</li>
                <li>shuffle([1, 2, 3, 4, 5]) . PHP_EOL; // シャッフル</li>
                <li>array_unique([1, 1, 4, 4, 2]) . PHP_EOL; // 1 4 2 重複を取り除く</li>
            </ul>
            <a href="https://www.php.net/">公式</a>
            <p>英語しか検索できないので、おすすめはGoogle検索で 「文字列　関数　site:php.net」</p>
        </li>
        <h2>文字列系</h2>
        <li>
            <h3>sprintf() 文字列をフォーマットに従って表示</h3>
            <h3>printf() フォーマットに従って表示</h3>
            <p>表示の設定 文字列：<span class="red">%s　整数：%d　浮動小数点数：%f</span></p>
            <pre>
        $name = 'Apple';
        $score = 32.246;

        $info = "[$name][$score]";
        echo $info . PHP_EOL; // [Apple][32.246]

        $info = <span class="red">sprintf</span>("[%15s][%10.2f]", $name, $score);
        echo $info . PHP_EOL;// [          Apple]15文字に収める　[     32.25]10文字 小数点以下２

        $info = sprintf("[%-15s][%010.2f]", $name, $score);// [          Apple]15文字に収める　[     32.25]10文字 小数点以下２
        echo $info . PHP_EOL;// [Apple          ]先頭に　[0000032.25]空欄を0で埋める

        #printf 単にフォーマットに従って表示
        <span class="red">printf</span>("[%-15s][%010.2f]" . PHP_EOL, $name, $score);
    </pre>
        </li>
        <li>
            <h3>strlen() 文字数を調べる</h3>
            <h3>trim() 空白・改行を除いて数える</h3>
            <h3>strpos() ある値が何文字目にヒットするか(0からスタート)</h3>
            <h3>str_replace(対象文字, 置換文字, 値) 置換</h3>

            <pre>
                # strlen() 文字数を調べる
                $input = 'dot_taguchi';
                echo <span class="red">strlen</span>($input) . PHP_EOL; // 11
                $input = ' dot_taguchi   ';
                echo strlen($input) . PHP_EOL; // 15
                
                # trim() 空白・改行を除いて数える
                $input = <span class="red">trim</span>($input);
                echo strlen($input) . PHP_EOL; // 11
                
                # strpos() ある値が何文字目にヒットするか(0からスタート)
                echo <span class="red">strpos</span>($input, '_') . PHP_EOL; // 3
                
                # str_replace(対象文字, 置換文字, 値) 置換
                $input = <span class="red">str_replace</span>('_', '^', $input);
                echo $input . PHP_EOL;// dot^taguchi%
            </pre>
        </li>
        <li>
            <h3>mb_***() 日本語の場合 マルチバイト</h3>
            <pre>
                $ja = 'こんにちは ';
                $ja = trim($ja);
                
                echo strlen($ja) . PHP_EOL;// 5 > 15
                echo <span class="red">mb_</span>strlen($ja) . PHP_EOL;// 5
                
                echo strpos($ja, 'に') . PHP_EOL;// 2 > 6
                echo <span class="red">mb_</span>strpos($ja, 'に') . PHP_EOL;// 2
                
                $ja = str_replace('にち', 'ばん', $ja);
                echo $ja . PHP_EOL;// こんばんは
            </pre>
        </li>
        <li>
            <h3>固定長データ substr(文字列, 位置, 桁数)</h3>
            <h3>substr_replace(文字列, 置換文字, 位置, 桁数)</h3>
            <pre>
                $itemId = '20220613Item-A  1200';
                $date = <span class="red">substr</span>($itemId, 0, 8);
                $product = substr($itemId, 8, 8);
                // $amount = substr($itemId, 16, 4);
                $amount = substr($itemId, 16);// 最後までの桁数は省略可能
                
                echo $date . PHP_EOL;// 20220613
                echo $product . PHP_EOL;// Item-A__
                echo number_format($amount) . PHP_EOL;// 1,200
                
                $itemId = <span class="red">substr_replace</span>($itemId, 'Item-B  ', 8, 8);
                echo $itemId . PHP_EOL;// Item-B__
            </pre>
        </li>
        <li>
            <h3>文字列を検索・置換 preg_match() preg_match_all() preg_replace()</h3>
            <pre>
                $input = 'Call us at 03-3001-1256 or 03-3015-3222';
                $pattern = '/\d{2}-\d{4}-\d{4}/';
                
                <span class="red">preg_match</span>($pattern, $input, $matches);
                print_r($matches);// 最初に見つかったパターンのみ配列で表示
                <span class="red">preg_match_all</span>($pattern, $input, $matches);
                print_r($matches);// 見つかった全てのパターンを配列で表示
                
                $input = <span class="red">preg_replace</span>($pattern, '**-****-****', $input);
                echo $input . PHP_EOL;// Call us at **-****-**** or **-****-****
            </pre>
        </li>
        <li>
            <h3>文字列と配列を交換</h3>
            <h3>implode(区切り文字, 値)　配列 ＞ 文字</h3>
            <h3>explode(区切り文字, 値)　文字 ＞ 配列</h3>
            <pre>
                $d = [2022, 06, 13];
                echo "$d[0]-$d[1]-$d[2]" . PHP_EOL; // 2022-06-13
                echo <span class="red">implode</span>('-', $d) . PHP_EOL; // 2022-06-13

                $t = '17:32:45';
                print_r(<span class="red">explode</span>(':', $t));
            </pre>
        </li>
        <h2>数値系</h2>
        <li>
            <h3>小数点の扱い</h3>
            <pre>
                $n = 5.6283;
                echo <span class="red">ceil</span>($n) . PHP_EOL; //切り上げ 6
                echo <span class="red">floor</span>($n) . PHP_EOL; //切り捨て 5
                echo <span class="red">round</span>($n) . PHP_EOL; //四捨五入 6
                echo <span class="red">round</span>($n, 2) . PHP_EOL; //小数点以下２桁で四捨五入 5.63

                echo <span class="red">mt_ran</span>d(1, 6) . PHP_EOL; // 1-6のランダムな整数値を作成

                echo <span class="red">max</span>(3, 9, 4) . PHP_EOL; //最大値 9
                echo <span class="red">min</span>(3, 9, 4) . PHP_EOL; //最小値 3
            </pre>
            <h3>関数ではないけど　便利な定数</h3>
            <pre>
                echo <span class="red">M_PI</span> . PHP_EOL; // 円周率 3.14159...
                echo <span class="red">M_SQRT2</span> . PHP_EOL; // 2の平方根 1.41421...
            </pre>
        </li>
        <h2>配列</h2>
        <li>
            <h3>array_unshift() 先頭に要素を追加</h3>
            <h3>array_push() 末尾に要素を追加</h3>
            <h3>array_shift() 先頭の要素を削除</h3>
            <h3>array_pop() 末尾の要素を削除</h3>
            <p>★破壊的メソッド</p>
            <pre>
                $scores = [30, 40, 50];
                print_r($scores);

                <span class="red">array_unshift</span>($scores, 10, 20);
                <span class="red">array_push</span>($scores, 60, 70);
                $scores[] = 80; // 1つだけ末尾に追加
                print_r($scores); // 10 20 30 40 50 60 70 80

                <span class="red">array_shift</span>($scores);
                <span class="red">array_pop</span>($scores);
                print_r($scores); // 20 30 40 50 60 70
            </pre>
            <h3>array_slice(配列, 位置, 個数) 配列の一部を切り出す</h3>
            <p>★非破壊メソッド　元配列を変更しない</p>
            <pre>
                $scores = [30, 40, 50, 60, 70];
                // $partial = <span class="red">array_slice</span>($scores, 2, 3); // 最後までの場合は個数を省略可能
                $partial = <span class="red">array_slice</span>($scores, 2); // 同じ意味
                print_r($scores); // 元のまま
                print_r($partial); // 50 60 70
            
                $partial = <span class="red">array_slice</span>($scores, -2); // 最後から2番目
                print_r($partial); // 60 70
            </pre>
            <h3>array_splice(配列, 位置, 個数) を削除</h3>
            <p>★破壊的メソッド</p>
            <h3>array_splice(配列, 削除位置, 削除個数, 挿入要素)</h3>
            <pre>
                $scores = [30, 40, 50, 60, 70, 80];
            
                <span class="red">array_splice</span>($scores, 2, 2);
                print_r($scores); // 50 60　を削除して、30 40 70 80
            
                <span class="red">array_splice</span>($scores, 2, 1, 100);
                print_r($scores); // 70　を削除して、100を入れる　30 40 100 80
            
                <span class="red">array_splice</span>($scores, 2, 0, 99);
                print_r($scores); // 100を削除せず、99を入れる　30 40 99 100 80
            </pre>
            <h3>sort() rsort() 小さき順　大きい順 </h3>
            <h3>shuffle() シャッフル</h3>
            <h3>array_rand(値, 数) キーを返す</h3>
            <pre>
                $scores = [40, 50, 20, 30];
                # sort() rsort() 小さき順　大きい順 
                <span class="red">sort</span>($scores);
                print_r($scores); // 20 30 40 50

                <span class="red">rsort</span>($scores);
                print_r($scores); // 50 40 30 20

                # shuffle() ★破壊
                <span class="red">shuffle</span>($scores);
                print_r($scores); // シャッフル

                # array_rand(値, 数) キーを返す　★非破壊
                // 新しい配列を返すので変数で受ける
                $picked = <span class="red">array_rand</span>($scores, 2);
                print_r($picked); // ランダムに２つの値のキー
                //  値を返したければ
                echo $scores[$picked[0]] . PHP_EOL;
                echo $scores[$picked[1]] . PHP_EOL;
            </pre>
            <h3>array_fill(スタートindex,　終了index,　埋める値)</h3>
            <h3>range(スタート,　終了) 配列を作る</h3>
            <h3>array_sum() 合計値</h3>
            <pre>
                # array_fill(スタートindex,　終了index,　埋める値)
                $scores = <span class="red">array_fill</span>(0, 5, 10);
                print_r($scores); // 10 10 10 10 10

                # range(スタート,　終了) 配列を作る
                $scores = <span class="red">range</span>(1, 10);
                print_r($scores); // 1 ~ 10
                $scores = <span class="red">range</span>(1, 10, 2);
                print_r($scores); // 1 3 5 7 9

                echo <span class="red">array_sum</span>($scores) . PHP_EOL; // 合計値 25
                echo max($scores) . PHP_EOL; // 9
                echo min($scores) . PHP_EOL; // 1
                echo array_sum($scores) / count($scores) . PHP_EOL; // 平均　5
            </pre>
            <h3>array_merge(配列A,配列B) 配列の結合</h3>
            <h3>array_diff(配列A,配列B) 配列Aから配列Bを引く　差異のあるAが残る</h3>
            <h3>array_intersect(配列A,配列B) 配列Aと配列Bの共通の値のみ表示</h3>
            <pre>
                $a = [3, 4, 8];
                $b = [4, 8, 12];
                // 複数の配列
                # array_merge(配列A,配列B) 配列の結合
                $merge = <span class="red">array_merge</span>($a, $b);
                // $merge = [...$a, ...$b]; // 上と同じ意味(前出)
                print_r($merge); // 3 4 8 4 8 12

                # array_diff(配列A,配列B) 配列Aから配列Bを引く　差異のあるAが残る
                $diff1 = <span class="red">array_diff</span>($a, $b);
                print_r($diff1); // 3
                $diff2 = array_diff($b, $a);
                print_r($diff2); // 12

                # array_intersect(配列A,配列B) 配列Aと配列Bの共通の値のみ表示
                $common = <span class="red">array_intersect</span>($a, $b);
                print_r($common); // 4 8
            </pre>
            <h3>array_map($fn, $a) それぞれの値に関数を通す</h3>
            <pre>
                $prices = [100, 200, 300];
                // 10%の税込みに変更
                $newPrices = <span class="red">array_map</span>(
                    function ($n) {
                        return $n * 1.1;
                    },
                    // fn ($n) => $n * 1.1, // アロー関数
                    $prices
                );
                print_r($newPrices); // 110 220 330
            </pre>
            <h3>array_filter($a, $fn) // それぞれの値にテストをし true だった値のみを返す</h3>
            <pre>
                $numbers = range(1, 10); // 1 ~ 10
                // 偶数のみ
                $evenNumbers = <span class="red">array_filter</span>(
                    $numbers,
                    function ($n) {
                        // if ($n % 2 === 0) {
                        //     return true;
                        // } else {
                        //     return false;
                        // } // 条件のみ返しても同じ事
                        return $n % 2 === 0;
                    }
                );
                // アロー関数
                // $evenNumbers = <span class="red">array_filter</span>(
                //     $numbers,
                //     fn($n) => $n % 2 === 0
                // );
                print_r($evenNumbers); // 2 4 6 8 10
            </pre>
            <h3>配列のキー、値を操作</h3>
            <pre>
                <h3># array_keys() array_values()</h3>
                $scores = [
                    'taguchi' => 80,
                    'hayashi' => 70,
                    'kikuchi' => 60,
                ];
                $keys = <span class="red">array_keys</span>($scores);
                print_r($keys); // taguchi ...
                $valurs = <span class="red">array_values</span>($scores);
                print_r($valurs); // 80 70 ...

                <h3># array_key_exists　キーに含まれるか</h3>
                if (<span class="red">array_key_exists</span>('taguchi', $scores)) {
                    echo 'taguchi is here!' . PHP_EOL;
                }
                <h3># in_array　配列に含まれるか</h3>
                if (<span class="red">in_array</span>(80, $scores)) {
                    echo '80 is here!' . PHP_EOL;
                }
                <h3># array_search() 値を検索して対応するキーを返す</h3>
                echo <span class="red">array_search</span>(70, $scores) . PHP_EOL; // hayashi

                # (前出の sort rsort はキーを削除して連番になる)
                // sort($scores);
                // print_r($scores);
                // rsort($scores);
                // print_r($scores);

                <h3># asort() arsort() キーを保持したまま値でソート</h3>
                <span class="red">asort</span>($scores);
                print_r($scores);
                // Array
                // (
                //     [kikuchi] => 60
                //     [hayashi] => 70
                //     [taguchi] => 80
                // )
                <span class="red">arsort</span>($scores);
                print_r($scores);
                // Array
                // (
                //     [taguchi] => 80
                //     [hayashi] => 70
                //     [kikuchi] => 60
                // )

                <h3># ksort() krsort() キーでソートしたい</h3>
                <span class="red">ksort</span>($scores);
                print_r($scores);
                // Array
                // (
                //     [hayashi] => 70
                //     [kikuchi] => 60
                //     [taguchi] => 80
                // )
            </pre>
            <h3>複雑な配列でソート</h3>
            <pre>
                $data = [
                    ['name' => 'taguchi', 'score' => 80],
                    ['name' => 'kikuchi', 'score' => 60],
                    ['name' => 'hayashi', 'score' => 70],
                    ['name' => 'tamachi', 'score' => 60],
                ];
                <h3># usort() 破壊的？　一つの項目でのみソート(比較)可能</h3>
                <span class="red">usort</span>(
                    $data,
                    function ($a, $b) {
                        if ($a['score'] === $b['score']) {
                            return 0;
                        }
                        return $a['score'] > $b['score'] ? 1 : -1;
                    }
                );
                print_r($data);
            </pre>
            <h3>複数の条件のソート</h3>
            <pre>
                $data = [
                    ['name' => 'taguchi', 'score' => 80],
                    ['name' => 'kikuchi', 'score' => 60],
                    ['name' => 'hayashi', 'score' => 70],
                    ['name' => 'tamachi', 'score' => 60],
                ];
                <h3># array_multisort()　複数の項目でソート(比較)可能　破壊的？</h3>
                // scoreで並び替えた後に、nameで並び替える
                // <span>array_multisort</span>($scores, $names, $data)

                # array_column()
                $scores = array_column($data, 'score');
                $names = array_column($data, 'name');
                // print_r($scores);
                // print_r($names);

                // <span class="red">array_multisort</span>(
                //     $scores,
                //     $names,
                //     $data
                // );
                // print_r($data); // 菊池　田町　林　田口

                <span class="red">array_multisort</span>(
                    $scores, SORT_DESC, SORT_NUMERIC, // 大きい順　数値
                    $names, SORT_DESC, SORT_STRING, // 降順　文字列
                    $data
                );
                print_r($data); // 田口　林　田町　菊池
            </pre>
        </li>

        <h2>ファイル管理</h2>
        <li>
            <h3>ファイルを操作</h3>
            <pre>
                <h3># fopen() ファイルを操作</h3>
                <h3># fwrite()</h3>
                <h3># fclose()</h3>

                <h3># ファイルの新規作成　用意</h3>
                // names.txt　がなければ新しく作る ファイルポインタ(特殊な変数)を返すので $fp で受け取る
                //書き込みモード write の w

                // $fp = fopen('names.txt', 'w');
                // fwrite($fp, "taro\n");
                // fclose($fp);

                <h3># Unixコマンド</h3>
                // cat 中身の確認
                // 書き込みモード　実行する度に追加される訳ではなく、上書きされる

                <h3># テキストを追加</h3>
                // 書き込みモード　append の a

                // $fp = fopen('names.txt', 'a');
                // fwrite($fp, "jiro\n");
                // fwrite($fp, "saburo\n");
                // fclose($fp); // 実は自動で閉じるので省略可能だけど、分かりやすい

                <h3>#テキストを読み込む r</h3>
                // fread() サイズを指定して一気に読み込む
                // filesize() ファイルサイズを調べる

                // $fp = fopen('names.txt', 'r');
                // $contents = fread($fp, filesize('names.txt'));
                // fclose($fp);

                // echo $contents;

                <h3># 一行ずつ読み込む</h3>

                // $fp = fopen('names.txt', 'r');
                // while (($line = fgets($fp)) !== false) {
                //     echo $line;
                // }
                // fclose($fp);


                <h3># 新規作成</h3>
                // $contents = "taro\njiro\nsaburo\n";
                // file_put_contents('names.txt', $contents);

                <h3># 読み込み</h3>
                // $contents = file_get_contents('names.txt');
                // echo $contents;

                <h3># 一行ずつ配列の要素で読み込む</h3>
                // $lines = file('names.txt');
                // $lines = file('names.txt', FILE_IGNORE_NEW_LINES);// 末尾の改行を無視
                // var_dump($lines);
            </pre>
            <h3>ディレクトリの操作</h3>
            <pre>
                // file_put_contents('data/taro.txt', "taro\n");
                // file_put_contents('data/jiro.txt', "jiro\n");

                // $dp = opendir('data');
                // while (($item = readdir($dp)) !== false) {
                //     if ($item === '.' || $item === '..') {
                //         continue;
                //     }
                //     echo $item . PHP_EOL;
                // }

                // 上と同じ

                // foreach (glob('data/*.txt') as $item) {
                //     // echo $item . PHP_EOL; // data/***.txt
                //     echo basename($item) . PHP_EOL; // ***.txt
                // }
            </pre>
            <h3>ファイルのチェック</h3>
            <pre>
                # file_exists() ディレクトリ・ファイルが存在するかどうか
                if (file_exists('data')) {
                    echo 'data exists!' . PHP_EOL;
                }
                # is_writable() 書き込み可能か
                if (is_writable('data/taro.txt')) {
                    echo 'taro is writable!' . PHP_EOL;
                }
                # is_readable() 読み込み可能か
                if (is_readable('data/taro.txt')) {
                    echo 'taro is readable!' . PHP_EOL;
                }
                # exit 処理を止める
                if (!file_exists('data/saburo.txt')) {
                    echo 'Saburo not here!' . PHP_EOL;
                    exit; // 処理が止まる
                }
                echo 'end' . PHP_EOL;
            </pre>
        </li>
        <h2>日付の計算</h2>
        <li>
            <pre>
                # 日付 UNIX タイムスタンプ 1970/01/01 00:00:00 GMT
                // time() ↑からの経過秒数
                // 一日分　+24*60*60 +24h*60m*60s

                # data(フォーマット, UNIXタイムスタンプ)　見やすい形式に戻す
                // PHPが稼働しているマシンのタイムゾーンを考慮してローカルタイムになる

                # data('Y-m-d', time());
                // Y 年を4桁で
                // m 月を2桁で
                // d 日を2桁で

                # data('H:i:s', time());
                // 時:分:秒 を2桁ずつ

                # data('l', time());
                // 英語の曜日

                # data('W', time());
                // 一年の内の第何周目か

                echo time() . PHP_EOL;// 1655139737
                // echo date('Y-m-d l', time()) . PHP_EOL; // 2022-06-13 Monday
                echo date('Y-m-d l') . PHP_EOL; // 単に現在日時を表示する場合は time() を省略可

                // 特定日時のタイムスタンプを計算するのは面倒
                # mktime() 引数の順番に注意　時　分　秒　月　日　年
                echo date('Y-m-d l', mktime(0, 0, 0, 5, 1, 2000)) . PHP_EOL;// 2000-05-01 Monday

                // 日時っぽい文字列から
                echo date('Y-m-d l', strtotime('2022-06-14')) . PHP_EOL;
                echo date('Y-m-d l', strtotime('2022-06-14 +1 day')) . PHP_EOL;

                // ※ date() mktime() strtotime() 32bitのマシンでは2038年以降うまく動作しない
                // DateTimeクラス　が一般的　難しいのでまた
            </pre>
        </li>
    </ul>
    <!-- <h2>詳解PHP オブジェクト編</h2> -->
    <h2>詳解PHP 【オブジェクト編】</h2>
    <ul>
        <li>
            <h2>Class</h2>
            <pre>
                1:構造を定義する　class Post { ... }
                2:新しい値を作る　$post = new Post();
                3:オブジェクトを使う　$post->text = 'hello';
                　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　$post->likes = 0;
                　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　$post->show();
            </pre>
            <h4 class="gray">(オブジェクトを使わない場合)</h4>
            <pre class="gray">
                $posts = [];
                $posts[0] = ['text' => 'hello', 'likes' => 0];
                $posts[1] = ['text' => 'hello again', 'likes' => 0];

                print_r($posts);
                // Array
                // (
                //     [0] => Array
                //         (
                //             [text] => hello
                //             [likes] => 0
                //         )

                //     [1] => Array
                //         (
                //             [text] => hello again
                //             [likes] => 0
                //         )

                // )
                表示する関数
                function show($post)
                {
                    printf('%s (%d)' . PHP_EOL, $post['text'], $post['likes']);
                }
                show($posts[0]); // hello (0)
                show($posts[1]); // hello again (0)
            </pre>
            <h3>classを使った場合</h3>
            <pre>
                // -> アロー演算子　$this->***

                <span class="red">// クラス</span>
                <span class="red">class P</span>ost
                {
                    <span class="red">// プロパティ</span>
                    <span class="red">public</span> $text;
                    public $likes = 0;
                    
                    <span class="red">// コンストラクタ</span>
                    // public function <span class="red">__construct</span>(<span class="blue">$textFromNew</span>, $likesFromNew)
                    // {
                    //    <span class="red">$this-></span>text = <span class="blue">$textFromNew</span>;
                    //    $this->likes = $likesFromNew;
                    // }
                    <span class="blue">// 慣れたらプロパティと同じ名前の方が良い</span>
                    public function __construct(<span class="blue">$text</span>)
                    {
                        $this->text = <span class="blue">$text</span>;
                    }

                    <span class="red">// メソッド</span>
                    public <span class="red">function show()</span>
                    {
                        printf('%s (%d)' . PHP_EOL, $this->text, $this->likes);
                    }
                }
                $posts = [];

                <span class="gray">// $posts[0] = ['text' => 'hello', 'likes' => 0];</span>
                // $posts[0] = new Post();// インスタンス ()なくてもOK
                // $posts[0]->text = 'hello';
                // $posts[0]->likes = 0;
                $posts[0] = <span class="red">new P</span>ost(<span class="blue">'hello'</span>);<span class="red">// インスタンス</span>

                // $posts[1] = new Post();
                // $posts[1]->text = 'hello again';
                // $posts[1]->likes = 0;
                $posts[1] = new Post('hello again');

                <span class="gray">// show($posts[0]); // hello (0)</span>
                <span class="red">$posts[0]->show();</span> // hello (0)
                $posts[1]->show(); // hello again (0)
            </pre>
            <h2>アクセス修飾子</h2>
            <pre>
                // クラス
                class Post
                {
                    // プロパティ
                    <span class="red">public</span> $text; // <span class="red">アクセス修飾子 public　クラス外からもアクセス可能</span>
                    <span class="red">private</span> $likes = 0; // <span class="red">private このクラスの中でしか使えない</span>
                    // <span class="red">カプセル化：アクセス修飾子を付けて、何が出来るか出来ないかを明確にする事</span>
                    
                    // コンストラクタ
                    public function __construct($text)
                    {
                        $this->text = $text;
                    }

                    // メソッド
                    public function show()
                    {
                        printf('%s (%d)' . PHP_EOL, $this->text, $this->likes);
                    }
                    public function <span class="red">like()</span>
                    {
                        $this->likes++;

                        if ($this->likes > 100) {
                            $this->likes = 100;
                        }
                    }
                }
                $posts = [];

                $posts[0] = new Post('hello');
                $posts[1] = new Post('hello again');

                // $posts[0]->likes++; // <span class="red">privateにしたので不可</span>
                // $posts[0]->likes = -100;

                $posts[0]-><span class="red">like()</span>;

                $posts[0]->show(); // hello (<span class="red">1</span>)
                $posts[1]->show(); // hello again (0)
            </pre>
            <h2>型付け</h2>
            <p>PHPverで使えない?</p>
            <pre>
                <span class="red">declare(strict_types=1);// 強い型付け</span>

                class Post
                {
                private <span class="red">string</span> $text; // <span class="red">弱い型付け</span>

                public function __construct(<span class="red">string</span> $text) // <span class="red">弱い型付け</span>
                {
                    $this->text = $text;
                }

                public function show()
                {
                    printf('%s' . PHP_EOL, $this->text);
                }
                }

                $posts = [];
                // $posts[0] = new Post('hello');
                $posts[0] = new Post(5);// 弱い型付けは5を文字列にしてしまう
                $posts[1] = new Post('hello again');

                $posts[0]->show();
                $posts[1]->show();
            </pre>
            <h2>static const クラスプロパティ・クラスメソッド・オブジェクト定数</h2>
            <p>クラスに直接紐付け</p>
            <pre>
                class Post
                {
                    private $text;
                
                    <span class="red">// static クラス自身のプロパティやメソッドを設定 </span>(アクセス修飾子の後)
                    <span class="red">// self::$***　でアクセス</span>
                    <span class="red">// const 定数は大文字 $なし </span>(アクセス修飾子の後)
                    private <span class="red">static</span> $count = 0; <span class="blue">// クラスプロパティ　変数</span>
                    // private const <span class="red">VERSION</span> = 0.1; <span class="blue">//オブジェクト定数 大文字</span>
                    <span class="red">public</span> const VERSION = 0.1; //定数 の場合は変更される心配がないので public でも問題なし

                    public function __construct($text)
                    {
                        $this->text = $text;
                        <span class="red">self::$</span>count++;
                    }
                    
                    public function show()
                    {
                        printf('%s' . PHP_EOL, $this->text);
                    }
                    // classに紐付いたメソッド　static function
                    public <span class="red">static</span> function showInfo() { <span class="blue">// クラスメソッド</span>
                        printf('Count: %d' . PHP_EOL, self::$count);
                        printf('Version: %.1f' . PHP_EOL, self::VERSION);
                    }
                }
                $posts = [];
                
                $posts[0] = new Post('hello');
                $posts[1] = new Post('hello again');
                
                $posts[0]->show(); // hello
                $posts[1]->show(); // hello again
                
                // classから直接実行
                <span class="red">Post::showInfo();</span>
                // Count:2 // インスタンスを作った数
                // Version: 0.1 // VERSION
                echo <span class="red">Post::VERSION</span> . PHP_EOL; // 0.1　<span class="red">publicなので直接呼び出せる</span>
            </pre>
            <h2>クラスの継承</h2>
            <h3>クラスを継承する</h3>
            <pre>
                class Post <span class="blue">// 親クラス Superクラス</span>
                {
                    private $text;

                    public function __construct($text)
                    {
                        $this->text = $text;
                    }
                    
                    public function show()
                    {
                        printf('%s' . PHP_EOL, $this->text);
                    }
                }
                // 新しいクラスを作成
                // extends Post で Post を継承
                //SponsoredPostクラス が Postクラス を継承した
                class SponsoredPost <span class="red">extends</span> Post <span class="blue">// 子クラス Subクラス</span>
                {
                    private $sponsor;

                    public function __construct($text, $sponsor)
                    {
                        // 親クラスのコンストラクタにある $text を使うので
                        <span class="red">parent::__construct($text);</span>
                        $this->sponsor = $sponsor; // 独自のプロパティ
                    }
                    public function <span class="red">showSponsor()</span>
                    {
                        printf('%s' . PHP_EOL, $this->sponsor);
                    }
                }
                $posts = [];

                $posts[0] = new Post('hello'); // hello
                $posts[1] = new Post('hello again'); // hello again
                // $posts[2] = new SponsoredPost('hello hello'); // SponsoredPost の中身が空でも表示される hello hello
                $posts[2] = new SponsoredPost('hello hello', 'dotinstall');

                $posts[0]->show(); // hello
                $posts[1]->show(); // hello again
                $posts[2]->show(); // hello hello
                <span class="red">$posts[2]->showSponsor();</span> // dotinstall

            </pre>
            <h3>メソッドをover ride</h3>
            <p>親クラスと同名のメソッドを再定義する事</p>
            <pre>
                class Post
                {
                    // private $text; <span class="blue">// privateのままだと他のクラスで使えない</span>
                    <span class="red">protected</span> $text; <span class="red">// protected このクラスと継承したクラスでのみ使用可能</span>

                    public function __construct($text)
                    {
                        $this->text = $text;
                    }
                    
                    // final public function show() // final overrideして欲しくないメソッドをロック(アクセス修飾子の前)
                    public function <span class="blue">show()</span>
                    {
                        printf('%s' . PHP_EOL, $this->text);
                        // 親クラスで $text は private
                    }
                }

                class SponsoredPost extends Post
                {
                    private $sponsor;

                    public function __construct($text, $sponsor)
                    {
                        parent::__construct($text);
                        $this->sponsor = $sponsor;
                    }
                    public function showSponsor()
                    {
                        printf('%s' . PHP_EOL, $this->sponsor);
                    }
                    <span class="red">// メソッドのoverride 親クラスと同名のメソッドを再定義</span>
                    public function <span class="blue">show()</span>
                    {
                        printf('%s by %s' . PHP_EOL, $this->text, $this->sponsor);
                    }
                }
                $posts = [];

                $posts[0] = new Post('hello'); // hello
                $posts[1] = new Post('hello again'); // hello again
                // $posts[2] = new SponsoredPost('hello hello');
                $posts[2] = new SponsoredPost('hello hello', 'dotinstall');

                $posts[0]->show(); // hello
                $posts[1]->show(); // hello again
                <span class="red">$posts[2]->show();</span> // hello hello > <span class="red">hello hello by dotinstall</span>
                $posts[2]->showSponsor(); // dotinstall
            </pre>
            <h3>型の継承</h3>
            <p>プロパティやメソッドの他に、<span class="red">データ型も継承している</span></p>
            <p>SponsoredPost　は　Post型としても扱える</p>
            <pre>
                class Post
                {
                    protected $text;

                    public function __construct($text)
                    {
                        $this->text = $text;
                    }
                    
                    public function show()
                    {
                        printf('%s' . PHP_EOL, $this->text);
                    }
                }

                class SponsoredPost extends Post
                {
                    private $sponsor;

                    public function __construct($text, $sponsor)
                    {
                        parent::__construct($text);
                        $this->sponsor = $sponsor;
                    }
                    
                    public function show()
                    {
                        printf('%s by %s' . PHP_EOL, $this->text, $this->sponsor);
                    }
                }
                $posts = [];

                $posts[0] = new Post('hello');
                $posts[1] = new Post('hello again');
                $posts[2] = new SponsoredPost('hello hello', 'dotinstall');

                <span class="red">// Post型の変数を受け取って処理する関数を作り、確かめる</span>
                function processPost(Post $post)<span class="red">// Post型のpostのみ受け付ける</span>
                {
                    $post->show();
                }

                foreach ($posts as $post) {
                    processPost($post);
                }
                <span class="red">// 同じ結果に。 SponsoredPostもPost型として扱えるという事</span>
                // $posts[0]->show(); // hello
                // $posts[1]->show(); // hello again
                // $posts[2]->show(); // hello hello by dotinstall

            </pre>


            <h3>レベルアップしたら</h3>
            <p>むずすぎる</p>
            <ul>
                <li>抽象クラス　抽象メソッド</li>
                <li>インターフェース</li>
                <li>トレイト</li>
                <li>外部ファイルを読み込む</li>
                <li>クラスを自動的に読み込む</li>
                <li>名前空間</li>
                <li>例外処理</li>
            </ul>
        </li>
        <li>

        </li>
    </ul>
    <!-- <h2>詳解PHP ウェブ開発編</h2> -->
    <h2>詳解PHP 【ウェブ開発編】</h2>
    <h2>サーバーを起動</h2>
    <p>PCにdockerを導入し、その上でサーバーを起動</p>
    <p>サーバーとPCに、以下のファイルを置き、同期されるように設定</p>
    <ul>
        <li>work/
            <ul>
                <li>app/　ブラウザからアクセスして欲しくないファイル</li>
                <li>web/　アクセス localhost:8080</li>
            </ul>
        </li>
    </ul>
    <p>開発環境を起動　ターミナルに</p>
    <code>docker-compose up -d</code>
    <p>work以外のフォルダやファイルを触らない！</p>
    <p>ブラウザでアクセス　index.html index.php　は省略可能</p>

    <h2>記法</h2>
    <p>&lt;?php *** ?&gt;</p>
    <p>出力　&lt;?php <span class="red">echo</span> *** ?&gt;</p>
    <p>出力の短縮記法　&lt;?<span class="red">=</span> *** ?&gt;</p>
    <p>基本は文中に長い記述を書かないので、変数を冒頭で用意し文中で変数を割り当てる　セキュリティ対策</p>
    <p><span class="red">htmlspecialchars(変換したい文字列, 変換の為のフラグ, 文字コード);</span> HTMLのタグを文字実体参照に変更する
        <br>
        $name, <span class="blue">ENT_QUOTES</span>, 'UTF-8'
        <br>
        <span class="blue">クォーテーションも変換してね</span>
    </p>
    <p>よく使うので関数に
    <pre>
            function h($str) {
                return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');
              }
        </pre>
    <pre>
            &lt;?= h(&apos;&lt;p&gt;あああ&lt;/p&gt;&apos;); ?&gt;
            // &lt;p&gt;あああ&lt;/p&gt;
        </pre>
    </p>
    <p>appフォルダ functions.phpに移し、読み込む
        <code>
            require('../app/functions.php');
        </code>
    </p>

    <h2>配列</h2>
    <h4>foreach</h4>
    <pre>
        foreach (...) <span class="red">{</span>
            ...
        <span class="red">}</span>
        <span class="blue">↓</span>
        foreach (...) <span class="red">:</span>
            ...
        <span class="red">endforeach;</span>
    </pre>

    <h4>if</h4>
    <pre>
        if (...) <span class="red">{</span>
            ...
        <span class="red">}</span> elseif (...) <span class="red">{</span>
            ...
        <span class="red">}</span> else <span class="red">{</span>
            ...
        <span class="red">}</span>
        <span class="blue">↓</span>
        if (...) <span class="red">:</span>
            ...
        elseif (...) <span class="red">:</span>
            ...
        else <span class="red">:</span>
            ...
        <span class="red">endif;</span>
                </pre>

    <h4>for</h4>
    <pre>
            for (...) <span class="red">{</span>
                ...
            <span class="red">}</span>
            <span class="blue">↓</span>
            for (...) <span class="red">:</span>
                ...
            <span class="red">endfor;</span>
        </pre>

    <h4>while</h4>
    <pre>
            while (...) <span class="red">{</span>
                ...
            <span class="red">}</span>
            <span class="blue">↓</span>
            while (...) <span class="red">:</span>
                ...
            <span class="red">endwhile;</span>
        </pre>
    <p class="red">※ do while　には使えない</p>
    <h4>switch</h4>
    <pre>
            switch (...) <span class="red">{</span>
                cace 1:
                ...
                cace 2:
                ...
                <span class="red">}</span>
                <span class="blue">↓</span>
                switch (...) <span class="red">:</span>
                cace 1:
                ...
                cace 2:
                ...
            <span class="red">endswitch;</span>
        </pre>

    <pre>
    $names = [
    'Taro',
    'Jiro',
    'Saburo',
    ];
      
    &lt;ul&gt;
        &lt;?php if (empty($names)) { ?&gt;
            &lt;li&gt;Nobody!&lt;/li&gt;
          &lt;?php } else { ?&gt;
            &lt;?php foreach ($names as $name) { ?&gt;
              &lt;li&gt;&lt;?= h($name); ?&gt;&lt;/li&gt;
            &lt;?php } ?&gt;
          &lt;?php } ?&gt;
    &lt;/ul&gt;

        <span class="blue">↓</span>

    &lt;ul&gt;
        &lt;?php if (empty($names)) : ?&gt;
          &lt;li&gt;Nobody!&lt;/li&gt;
        &lt;?php else : ?&gt;
          &lt;?php foreach ($names as $name) : ?&gt;
            &lt;li&gt;&lt;?= h($name); ?&gt;&lt;/li&gt;
            &lt;?php endforeach; ?&gt;
          &lt;?php endif ?&gt;
    &lt;/ul&gt;
     </pre>
    <p>※　<span class="red">empty()</span> 空かどうか</p>

    <h2>共通部分を部品化</h2>
    <ul>
        <li>
            <span class="red">require</span>('../app/functions.php');
            <br>
            <span class="red">読み込めなかったら処理を止める</span>
        </li>
        <li>
            <span class="red">include</span>('../app/_parts/_header.php');
            <br>
            <span class="red">読み込めなくても処理を止めない</span>
        </li>
    </ul>
    <h2>フォーム</h2>
    <h3>GET形式</h3>
    <p>値をURLを介して取得</p>
    <ul>
        <li>formを設置</li>
        <li>action に送信する先のファイル名</li>
        <li>method 方式　getとpostがある</li>
        <li>name どの名前で受け取るか
            <pre>
        &lt;form <span class="red">action</span>=&quot;result.php&quot; <span class="red">method=&quot;get&quot;</span>&gt;
            &lt;input type=&quot;text&quot; <span class="red">name</span>=&quot;<span class="blue">message</span>&quot;&gt;
            &lt;input type=&quot;text&quot; <span class="red">name</span>=&quot;username&quot;&gt;
            &lt;button&gt;Send&lt;/button&gt;
        &lt;/form&gt;
            </pre>
        </li>
        <li>action で指定したファイルを作成
            <pre>
        &lt;?php
        
        $<span class="blue">message</span> = <span class="red">filter_input</span>(<span class="red">INPUT_GET</span>, &apos;<span class="blue">message</span>&apos;);
        $username = filter_input(INPUT_GET, &apos;username&apos;);

        ?&gt;

        &lt;p&gt;&lt;?= h($<span class="blue">message</span>); ?&gt; by &lt;?= h($username); ?&gt;&lt;/p&gt;
        &lt;p&gt;&lt;a href=&quot;index.php&quot;&gt;Go back&lt;/a&gt;&lt;/p&gt; <span class="blue">戻るリンクも設置</span>
            </pre>
        </li>
        <li>フォームからの値を受け取り代入　$*** = filter_input(形式, name属性値);</li>
        <li>GET形式は送信した値がそのままURLに埋め込まれる
            <code>http://localhost:8080/result.php<span class="red">?</span><span class="blue">message</span>=hello<span class="red">&</span><span class="blue">username=Taro</span></code>
            <span class="blue">ネーム属性=値 クエリー文字列</span>　を <span class="red">?</span> 以下　<span class="red">&</span>で繋ぐ
        </li>
        <li>フォームを使わなくてもURLを編集すれば同じ事になる</li>
    </ul>
    <h3>空で送信された場合 ...に置き換え</h3>
    <code>
       $message = $message !== '' ? $message : '...';
    </code>
    <h3>空白を入力された場合の除去</h3>
    <code>
        $message = <span class="red">trim</span>(filter_input(INPUT_GET, 'message'));
    </code>
    <h3>テキストエリア</h3>
    <ul>
        <li>改行が半角空白　ページのソースには改行がある</li>
        <li>改行をタグに変換 <span class="red">nl2br();</span></li>
        <li>改行などの文字はURLでは %から始まる特殊文字で表現される</li>
    </ul>
    <h3>セレクトBOX</h3>
    <ul>
        <li>普通の選択
            <pre>
    &lt;form action=&quot;result.php&quot; method=&quot;get&quot;&gt;
        &lt;select name=&quot;color&quot;&gt;
        &lt;option value=&quot;orange&quot;&gt;Orange&lt;/option&gt;
        &lt;option value=&quot;pink&quot;&gt;Pink&lt;/option&gt;
        &lt;option value=&quot;gold&quot;&gt;Gold&lt;/option&gt;
        &lt;/select&gt;
        &lt;button&gt;Send&lt;/button&gt;
    &lt;/form&gt;
</pre>
            <code>$color = filter_input(INPUT_GET, 'color');</code>
        </li>
        <li>複数選択
            <pre>
    &lt;form action=&quot;result.php&quot; method=&quot;get&quot;&gt;
        &lt;select name=&quot;<span class="red">colors[]</span>&quot; <span class="red">multiple</span>&gt; <span class="blue">&lt;!-- 複数選択 --&gt;</span>
        &lt;option value=&quot;orange&quot;&gt;Orange&lt;/option&gt;
        &lt;option value=&quot;pink&quot;&gt;Pink&lt;/option&gt;
        &lt;option value=&quot;gold&quot;&gt;Gold&lt;/option&gt;
        &lt;/select&gt;
        &lt;button&gt;Send&lt;/button&gt;
    &lt;/form&gt;
</pre>
            <p>⌘を押しながら複数選択可能</p>
            <pre>
    $colors = filter_input(INPUT_GET, 'colors', <span class="red">FILTER_DEFAULT</span>, <span class="red">FILTER_REQUIRE_ARRAY</span>);
    <span class="red">// FILTER_DEFAULT デフォルトで受け取り  FILTER_REQUIRE_ARRAY 配列に</span>
    $colors = empty($colors) ? 'None selected' : implode(',', $colors);
</pre>
        </li>
    </ul>
    <h3>チェックボックス</h3>
    <p>セレクトＢＯＸの複数選択と同じ</p>
    <pre>
&lt;form action=&quot;result.php&quot; method=&quot;get&quot;&gt;
    &lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;colors[]&quot; value=&quot;orange&quot;&gt;Orange&lt;/label&gt;
    &lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;colors[]&quot; value=&quot;pink&quot;&gt;Pink&lt;/label&gt;
    &lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;colors[]&quot; value=&quot;gold&quot;&gt;Gold&lt;/label&gt;
  &lt;button&gt;Send&lt;/button&gt;
&lt;/form&gt;
</pre>

    <h3>ラジオボタン</h3>
    <p>選択されなければNullが返る</p>
    <p>
        $color = <span class="red">isset</span>($color) ? $color : 'Null';
        <br>
        $color = $color <span class="red">??</span> 'Null'; // <span class="red">?? Null合体演算子</span>　上と同じ意味
    </p>

    <h3>背景色を選択した値に</h3>
    <ol>
        <li>最初はサーバーにGetで送った値をセットして背景色を変更し、サーバーから返す</li>
        <li>クッキーにカラーの値をブラウザで保存し、ページ遷移する際にセットでサーバーに送って返す</li>
    </ol>
    <ul>
        <li>index.php
            <pre>
        &lt;form action=&quot;result.php&quot; method=&quot;get&quot;&gt;
            &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;bg&quot; value=&quot;orange&quot;&gt;Orange&lt;/label&gt;
            &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;bg&quot; value=&quot;pink&quot;&gt;Pink&lt;/label&gt;
            &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;bg&quot; value=&quot;gold&quot;&gt;Gold&lt;/label&gt;
            &lt;button&gt;Send&lt;/button&gt;
        &lt;/form&gt; 
        </pre>
        </li>
        <li>result.php
            <pre>
            // 背景色を変更
            $bgFromGet = filter_input(INPUT_GET, 'bg');
            <span class="red">// クッキーにカラーを保存 ★setcookie() 前に何も出力してはいけない</span>
            <span class="red">setcookie</span>('bg', $bgFromGet);
        </pre>
        </li>
        <li>_header.php
            <pre>
            &lt;?php

            $bg = $bgFromGet ?? filter_input(<span class="red">INPUT_COOKIE</span>, &apos;bg&apos;) ?? &apos;transparent&apos;;

            ?&gt;
        </pre>
        </li>
    </ul>
    <h3>クッキーの値の確認</h3>
    <ul>
        <li>デベロッパーツール</li>
        <li>アプリケーションパネル Application</li>
        <li>サイドバー Cookies</li>
        <li>ドメインごとに管理　Name:bg Value:pink</li>
        <li>Domain:有効なドメイン Path:有効なディレクトリ配下 Expires:有効期限(デフォルトではSession ブラウザを閉じるまで)</li>
        <li>セットクッキーのオプションでこれらの値をセット可能</li>
        <li>値を修正してリロードすると、確認が可能</li>
        <li>右クリックでDelete　リロード</li>
    </ul>
    <h3>コードからクッキーを削除</h3>
    <ul>
        <li>reset.php を作りリンク</li>
        <li>reset.php
            <pre>
    &lt;?php

    setcookie('bg', <span class="red">''</span>);
    //  空文字だとPHPが内部的に、クッキーの有効期限を過去日時にセットし、クッキーが削除される

    // ページのリロード 
    // setcookie同様これ以前に出力は禁止　半角スペース入れる　絶対パスで
    <span class="red">header('Location: http://localhost:8080/index.php');</span>
</pre>
        </li>
    </ul>
    <h2>Session</h2>
    <ul>
        <li>クッキーは外部から削除変更出来るので大事なデータを置くべきではない</li>
        <li>Sessionを使い、ブラウザではなくサーバーに保存</li>
        <li>ブラウザごとに保存はしたいので、紐付ける(その為だけにクッキーを使う)</li>
        <li>デフォルトでは PHPSESSID というクッキーがセットされ特殊な値を送信され紐付けれる</li>
    </ul>
    <p>Cookie Session の違い</p>
    <table class="col-2">
        <tr>
            <th>Cookie</th>
            <th>Session</th>
        </tr>
        <tr>
            <td>ブラウザ側に保存</td>
            <td>サーバー側に保存</td>
        </tr>
        <tr>
            <td>サイズ制限あり</td>
            <td>サイズ制限なし</td>
        </tr>
        <tr>
            <td>文字列のみ</td>
            <td>オブジェクトなどもOK</td>
        </tr>
        <tr>
            <td>安全性が低い</td>
            <td>安全性が高い</td>
        </tr>
        <tr>
            <td>簡単な設定項目など</td>
            <td>認証情報など</td>
        </tr>
    </table>
    <h3>Sessionの値を保存</h3>
    <p>CookieをSessionに書き換える</p>
    <ol>
        <li>全てのページで使うので function.php（他ページでも読み込む require）
            <br>
            セッションを使いますよ
            <code><span class="red">session_start</span>();</code>
        </li>
        <li>result.php 値をセット session_start();を使うと特殊な変数　$_SESSION が使える
            <br>
            GETで渡ってきた値を代入
            <code><span class="red">$_SESSION</span>['bg'] = $bgFromGet;</code>
        </li>
        <li>_header.php
            <br>
            Cookie と違い、サーバーで値を保持しているのでresult.phpで値をセットした直後から使える
            <br>
            <code>$bg = <span class="red">$_SESSION</span>['bg'] ?? filter_input(INPUT_COOKIE, 'bg') ?? 'transparent';</code>
        </li>
        <li>reset.php セッションのカラーをリセットしたい
            <br>
            <code>unset(<span class="red">$_SESSION</span>['bg']);</code>
        </li>
        <li>
            ※削除したのはSessionの中のカラーの値だけで、ブラウザとサーバーの値を紐付ける為のCookieは削除されてない
        </li>
    </ol>


    <h3>GET　と　POST</h3>
    <table class="col-2">
        <tr>
            <th>GET</th>
            <th>POST</th>
        </tr>
        <tr>
            <td>情報の取得</td>
            <td>情報の追加/更新/削除</td>
        </tr>
        <tr>
            <td>index.php?name=taro</td>
            <td>index.php(ブラウザの機能で値を確認可)</td>
        </tr>
        <tr>
            <td>安全性が低い</td>
            <td>安全性がやや高い</td>
        </tr>
        <tr>
            <td>サイズや種類に制限あり</td>
            <td>サイズや種類に制限なし</td>
        </tr>
    </table>

    <h2>掲示板を作ろう</h2>
    <ol>
        <li>app/k_messages.txt
            <br>
            フォームからのメッセージを保存するテキスト
        </li>
        <li>k_index.php
            <br>
            <pre>
            &lt;?php

            require(&apos;../app/k_functions.php&apos;);

            // (定数)
            define(&apos;FILENAME&apos;, &apos;../app/k_messages.txt&apos;);

            // 二重投稿禁止の為、resultから移動
            if ($_SERVER[&apos;REQUEST_METHOD&apos;] === &apos;POST&apos;) {
                
            // POSTされた値
            $message = trim(filter_input(INPUT_POST, &apos;message&apos;));
            $message = $message !== &apos;&apos; ? $message : &apos;...&apos;;
            // を、txtにadd 改行をつけて
            // $filename = &apos;../app/k_messages.txt&apos;;
            // $fp = fopen($filename, &apos;a&apos;);
            $fp = fopen(FILENAME, &apos;a&apos;);
            fwrite($fp, $message . &quot;\n&quot;);
            fclose($fp);

            // result にリダイレクト
            header(&apos;Location: http://localhost:8080/k_result.php&apos;);
            exit;
            } 
            // else {
            //   // POSTでアクセスでなければ処理を止める
            //   exit(&apos;Invalid Request&apos;);
            // }



            // $filename = &apos;../app/k_messages.txt&apos;;
            // （末尾の改行を無視し、一行ずつ読み込む）配列
            // $messages = file($filename, FILE_IGNORE_NEW_LINES);
            $messages = file(FILENAME, FILE_IGNORE_NEW_LINES);

            include(&apos;../app/_parts/_k_header.php&apos;);

            ?&gt;

            &lt;ul&gt;
            &lt;?php foreach ($messages as $message): ?&gt;
            &lt;li&gt;&lt;?= h($message); ?&gt;&lt;/li&gt;
            &lt;?php endforeach; ?&gt;
            &lt;/ul&gt;

            &lt;!-- &lt;form action=&quot;k_result.php&quot; method=&quot;post&quot;&gt; --&gt;
                &lt;!-- result を更新すると二重投稿される為、送り先ファイルを別にする index.phpなら空にしたり、action属性ごと削除でも同意 --&gt;
            &lt;form action=&quot;k_index.php&quot; method=&quot;post&quot;&gt;
                &lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;
                &lt;button&gt;Post&lt;/button&gt;
            &lt;/form&gt;

            &lt;a href=&quot;index.php&quot;&gt;index&lt;/a&gt;
            &lt;?php

            include(&apos;../app/_parts/_footer.php&apos;);
        </pre>
        </li>
        <li>
            k_result.php
            <br>
            <pre>
            &lt;?php

            require(&apos;../app/k_functions.php&apos;);

            // 直接アドレスにアクセスすると、 ... が増えるので
            // POSTされたかどうかを $_SERVER という特殊な変数で調べる
            // REQUEST_METHOD が POST だったら次の処理をしなさい　条件分岐

            // if ($_SERVER[&apos;REQUEST_METHOD&apos;] === &apos;POST&apos;) {
                
            //     // POSTされた値
            //     $message = trim(filter_input(INPUT_POST, &apos;message&apos;));
            //     $message = $message !== &apos;&apos; ? $message : &apos;...&apos;;
            //     // を、txtにadd 改行をつけて
            //     $filename = &apos;../app/k_messages.txt&apos;;
            //     $fp = fopen($filename, &apos;a&apos;);
            //     fwrite($fp, $message . &quot;\n&quot;);
            //     fclose($fp);
            // } else {
            //     // POSTでアクセスでなければ処理を止める
            //     exit(&apos;Invalid Request&apos;);
            // }

            include(&apos;../app/_parts/_k_header.php&apos;);

            // var_dump($message);
            ?&gt;
            &lt;p&gt;Message added!&lt;/p&gt;
            &lt;p&gt;&lt;a href=&quot;k_index.php&quot;&gt;Go back&lt;/a&gt;&lt;/p&gt;

            &lt;?php

            include(&apos;../app/_parts/_footer.php&apos;);
        </pre>
        </li>
        <li>
            k_function.php
            <br>
            <pre>
            &lt;?php

            function h($str) {
                return htmlspecialchars($str, ENT_QUOTES, &apos;UTF-8&apos;);
              } 
        </pre>
        </li>
    </ol>

    <h3>CSRF対策</h3>
    <p>Cross Site Request Forgery　別のサイトからリクエストが偽造されてくる</p>
    <p>代表的な対処方法 tokenを使う</p>
    <ol>
        <li>
            index.phpから推測が難しい token を発行しブラウザに値を埋め込む
        </li>
        <li>
            sessionを使いサーバーにも token を保存
        </li>
        <li>フォームを送信する際に、この token を一緒に送信する</li>
        <li>サーバー側で処理をする際に、 token が一致した場合だけ投稿処理をする</li>
        <li>悪意のある攻撃は token がないので弾かれる</li>
        <li>token はアクセスしてきたブラウザごとにランダムに生成される為、推測するのは現時点では困難(おいかけっこ)</li>
    </ol>
    <h3>トークンの実装方法</h3>
    <ul>
        <li>function.php
            <br>
            <span class="red">random_bytes</span>(32) 暗号学的に安全でランダムな文字列をbyte単位で生成 32バイト バイナリの文字列なので
            <br>
            <span class="red">bin2hex</span>() 16進数の文字列にする
            <pre>
                function createToken() {
                    if (!isset($_SESSION['token'])) {
                        $_SESSION['token'] = <span class="red">bin2hex(random_bytes</span>(32)); 
                    }
                }
                function validateToken() {
                    if (
                        empty($_SESSION['token']) ||
                        $_SESSION['token'] !== filter_input(INPUT_POST, 'token')
                    ) {
                        exit('Invalid post request');
                    }
                }

                session_start();
            </pre>
        </li>
        <li>
            index.php
            <pre>
                &lt;?php

                require(&apos;../app/k_functions.php&apos;);

                <span class="red">createToken();</span>

                define(&apos;FILENAME&apos;, &apos;../app/k_messages.txt&apos;);

                if ($_SERVER[&apos;REQUEST_METHOD&apos;] === &apos;POST&apos;) {
                    <span class="red">validateToken();</span>
                    
                $message = trim(filter_input(INPUT_POST, &apos;message&apos;));
                $message = $message !== &apos;&apos; ? $message : &apos;...&apos;;

                $fp = fopen(FILENAME, &apos;a&apos;);
                fwrite($fp, $message . &quot;\n&quot;);
                fclose($fp);

                header(&apos;Location: http://localhost:8080/k_result.php&apos;);
                exit;
                } 

                $messages = file(FILENAME, FILE_IGNORE_NEW_LINES);

                include(&apos;../app/_parts/_k_header.php&apos;);

                ?&gt;

                &lt;ul&gt;
                &lt;?php foreach ($messages as $message): ?&gt;
                &lt;li&gt;&lt;?= h($message); ?&gt;&lt;/li&gt;
                &lt;?php endforeach; ?&gt;
                &lt;/ul&gt;

                &lt;form action=&quot;k_index.php&quot; method=&quot;post&quot;&gt;
                    &lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;
                    &lt;button&gt;Post&lt;/button&gt;
                    <span class="red">&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&lt;?= h($_SESSION[&apos;token&apos;]); ?&gt;&quot;&gt;</span>
                &lt;/form&gt;

                &lt;a href=&quot;index.php&quot;&gt;index&lt;/a&gt;
                &lt;?php

                include(&apos;../app/_parts/_footer.php&apos;);
            </pre>
        </li>
    </ul>

    <!-- <h2>詳解PHP データベース編</h2> -->
    <h2>詳解PHP 【データベース編】</h2>
    <h3>PHP MySQLの関係</h3>
    <table class="center col-5">
        <tr>
            <td rowspan="2">ブラウザ</td>
            <td>→　URL →</td>
            <td rowspan="2">PHP<br><span class="red">PDO</span></td>
            <td>→　SQL →</td>
            <td rowspan="2">データベース(MySQL)</td>
        </tr>
        <tr>
            <td>←　HTML ←</td>
            <td>←　DATA ←</td>
        </tr>
    </table>
    <p><span class="red">PDO : PHP Database Object</span>
        PHPからデータベースへのアクセスを抽象化
        <br>
        データベースの種類が変わってもコードを変更する必要がない
    </p>
    <p>今回の学習ではPHPもPDOもMySQLも準備済み</p>
    <p>dotinstallの実行環境で行う</p>
    <ul>
        <li>マシン host:db</li>
        <li>database: myapp</li>
        <li>user: dbuser</li>
        <li>pass: dbpass</li>
    </ul>

    <h3>PDOオブジェクトを作る</h3>
    <ol>
        <li>DSN(Data Souce Name)
            <ul>
                <li>MySQLの場合</li>
                <li>'<span class="red">mysql:</span></li>
                <li><span class="red">host=</span>ホストを指定(MySQLがセットアップされたマシンの名前);</li>
                <li><span class="red">dbname=</span>扱っていくデータベースの名前;</li>
                <li><span class="red">charset=</span>文字コード',</li>
            </ul>
        </li>
        <li><span class="red">'ユーザー名',</span></li>
        <li><span class="red">'パスワード',</span></li>
    </ol>
<pre>
    &lt;?php

    $pdo = new PDO(
    // DNS (Data Souce Name) 
    '<span class="red">mysql:</span><span class="red">host=</span>db;<span class="red">dbname=</span>myapp;<span class="red">charset=</span>utf88mb4',
    <span class="red">// user</span>
    'dbuser',
    <span class="red">// password</span>
    'dbpass'
    );
</pre>
<h3>PDOオブジェクトを使ってSQLを発行する</h3>
<p class="blue">$pdo->query()</p>
<pre>
    &lt;?php

    $pdo = new PDO(
    'mysql:host=db;dbname=myapp;charset=utf8mb4',
    'dbuser',
    'dbpass',
    <span class="red">
        // カラム名だけを取得
        [
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            ]
        );
    </span>
    // SQLの中は'を使うので、SQLは<span class="red">"</span>
    // <span class="red">query</span>()メソッドの結果はPDIStatementオブジェクトで返ってくるので$stmtで受け取る
    $stmt = $pdo-><span class="red">query</span>("SELECT 5 + 3");
    // 配列で取得したい場合、単一の結果なら<span class="red">fetch</span>()
    $result = $stmt-><span class="red">fetch</span>();
    var_dump($result);
</pre>
<pre>
    // ターミナル
    array(1) {
        ["5 + 3"]=>
        string(1) "8"
      }
</pre>
<h3>エラーメッセージをオプションで表示</h3>
<pre>
    &lt;?php

<span class="red">try {</span>
    $pdo = new PDO(
        'mysql:host=db;dbname=myapp;charset=utf8mb4',
        'dbuser',
        'dbpass',
        [
        <span class="red">PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,</span>
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        ]
    );
    
    $stmt = $pdo->query("SELCT 5 + 3");
    $result = $stmet->fetch();
    var_dump($result);
<span class="red">
} catch (PDOException $e) {
echo $e->getMessage() . PHP_EOL;
exit;
}
</span>
</pre>

<h3>テーブルを作成</h3>
<pre>
    &lt;?php

    try {
    $pdo = new PDO(
        'mysql:host=db;dbname=myapp;charset=utf8mb4',
        'dbuser',
        'dbpass',
        [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        ]
    );
    <span class="red">
        // もしあれば削除
        $pdo->query("DROP TABLE IF EXISTS posts");
        // テーブルを作成
        $pdo->query(
            "CREATE TABLE posts (
                id INT NOT NULL AUTO_INCREMENT,
                messsage VARCHAR(140),
                likes INT,
                PRIMARY KEY (id)
                )"
            );
    </span>

    $stmt = $pdo->query("SHOW TABLES");
    $result = $stmt->fetch();
    var_dump($result);
    } catch (PDOException $e) {
    echo $e->getMessage() . PHP_EOL;
    exit;
    }
</pre>

    <div id="toTop"><a href="#">TOP</a></div>
    <script>
        // (function (window, document) {
        const h2s = document.querySelectorAll('h2');
        const toc = document.getElementById('toc');
        const tocTitle = document.querySelector('.toc-title');

        const ul = document.createElement('ul');
        h2s.forEach((h2, i) => {
            h2.id = `h2_${i}`;
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `#h2_${i}`;
            a.textContent = h2.textContent;
            li.appendChild(a);
            ul.appendChild(li);
        });
        toc.append(ul);
        // })(window, document);
        // (function (window, document) {
        //     const selector = document.querySelector('.post-body');
        //     if (!selector) {
        //         return
        //     }

        //     const toc = document.createElement('details');
        //     const sum = document.createElement('summary');
        //     const list = document.createElement('ul');
        //     toc.id = 'toc';
        //     toc.open = true;
        //     sum.className = 'toc-title';
        //     sum.textContent = '目次';
        //     list.className = 'toc-container';
        //     toc.appendChild(sum);
        //     toc.appendChild(list);

        //     const headings = selector.querySelectorAll('h2, h3, h4');
        //     if (headings.length == 0) {
        //         return
        //     }
        //     headings[0].parentNode.insertBefore(toc, headings[0]);
        //     const order = [];
        //     const stack = [{ level: 1, element: list }];

        //     // 事前処理
        //     headings.forEach((heading) => {
        //         const level = parseInt(heading.tagName.substring(1))
        //         order.push(level);
        //     });

        //     headings.forEach((heading, i) => {
        //         const level = parseInt(heading.tagName.substring(1));
        //         const next = order[i + 1];
        //         const li = document.createElement('li');
        //         const a = document.createElement('a');
        //         const id = 'toc-' + (i + 1);
        //         const ul = document.createElement('ul');

        //         // 目次要素の生成
        //         a.textContent = heading.textContent;
        //         a.href = `#${id}`;
        //         li.appendChild(a);
        //         if (level < next) {
        //             li.appendChild(ul);
        //         }

        //         // リンク先の生成
        //         heading.id = id;

        //         // 階層構造の生成
        //         let parent;
        //         do {
        //             parent = stack.pop();
        //         } while (parent.level >= level);
        //         parent.element.appendChild(li);
        //         stack.push(parent);
        //         stack.push({ level: level, element: ul });
        //     });
        // }(window, document));

    </script>
</body>

</html>